<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generador de mails estandarizados – Nuevo Guido Spano</title>
  <meta name="description" content="Arma comunicaciones con formato estándar para copiar y pegar en Gmail. Incluye header/footer por nivel y logo institucional en la página." />
  <style>
    :root { --bg:#0f172a; --panel:#111827; --muted:#64748b; --text:#e5e7eb; --accent:#22c55e; --ring:rgba(34,197,94,.35); }
    html, body {height: 100%;}
    body {margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; background: linear-gradient(180deg, #0b1220, #0f172a 20%, #0b1220); color: var(--text);}    
    .container {max-width: 1100px; margin: 32px auto; padding: 0 16px;}
    .grid {display: grid; grid-template-columns: 1.1fr .9fr; gap: 20px;}
    .card {background: var(--panel); border: 1px solid #1f2937; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.25);}    
    .card h2 {margin: 0 0 16px; font-size: 18px; letter-spacing:.2px}
    .card .content {padding: 20px;}
    label {display: block; font-size: 12px; color: var(--muted); margin: 16px 0 8px;}
    input, select, textarea {width: 100%; box-sizing: border-box; background: #0b1220; color: var(--text); border: 1px solid #233046; border-radius: 12px; padding: 12px 14px; outline: none;}
    input:focus, select:focus, textarea:focus {border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring);}    
    textarea {min-height: 180px; resize: vertical;}
    .muted {color: var(--muted); font-size: 12px}
    .actions {display:flex; gap: 10px; flex-wrap: wrap;}
    button {appearance: none; border: 0; border-radius: 12px; background: var(--accent); color: #07130a; font-weight: 700; padding: 12px 16px; cursor: pointer;}
    button.secondary {background: #1f2937; color: #cbd5e1; border: 1px solid #2a3a54;}
    .footer-note {margin-top: 12px; font-size: 12px; color: var(--muted)}
    .preview-wrap {background:#0b1220; border-top: 1px solid #1f2937; padding:16px; border-radius: 0 0 18px 18px}
    .preview {background: white; color: black; max-width: 680px; margin: 0 auto; border: 1px solid #e5e7eb;}
    @media (max-width: 980px){ .grid{grid-template-columns: 1fr;} }
  </style>
</head>
<body>
  <div class="container">
    <div class="content" style="text-align:center; margin-bottom:24px;">
      <img src="logo.jpg" alt="Logo Colegio Guido Spano" style="height:70px; margin-bottom:12px;"/>
      <h1 style="margin:0">Generador de mails estandarizados</h1>
      <div class="muted">Versión con header/footer en PNG por nivel y logo institucional en la cabecera.</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="content">
          <h2>1) Completar la comunicación</h2>
          <label for="nivel">Nivel</label>
          <select id="nivel">
            <option value="inicial">Inicial</option>
            <option value="primario" selected>Primario</option>
            <option value="secundario">Secundario</option>
            <option value="superior">Superior</option>
          </select>

          <label for="asunto">Asunto</label>
          <input id="asunto" placeholder="Ej: Reunión informativa" />

          <label for="cuerpo">Cuerpo</label>
          <textarea id="cuerpo" placeholder="Escribí el texto aquí..."></textarea>

          <label for="firmaNombre">Firma</label>
          <input id="firmaNombre" placeholder="Nombre y Apellido" />

          <div class="actions">
            <button id="btn-generar">Generar vista previa</button>
            <button id="btn-copiar-html" class="secondary" disabled>Copiar HTML</button>
            <button id="btn-copiar-asunto" class="secondary" disabled>Copiar Asunto</button>
          </div>
          <div class="footer-note">Los PNG deben estar en la <strong>misma carpeta</strong> que este <code>index.html</code>.</div>
        </div>
      </div>

      <div class="card">
        <div class="content">
          <h2>2) Vista previa</h2>
        </div>
        <div class="preview-wrap"><div id="preview" class="preview"></div></div>
      </div>
    </div>
  </div>

  <script>
    // ================== CONFIG ==================
    const SCHOOL_NAME = 'Nuevo Guido Spano';
    const BASE_WEBSITE = 'www.nuevoguidospano.edu.ar';
    const ASSETS = ''; // usar rutas relativas (archivos en la raíz del repo)

    const IMAGES = {
      inicial:   { header: 'header_inicial.png',   footer: 'footer_inicial.png' },
      primario:  { header: 'header_primario.png',  footer: 'footer_primaria.png' },
      secundario:{ header: 'header_secundaria.png', footer: 'footer_secu.png' },
      superior:  { header: 'header_sup.png',       footer: 'footer_sup.png' },
      logos:     { main: 'logo.jpg' }
    };

    const LEVELS = {
      inicial:   { name: 'Nivel Inicial',    color: '#ffb703', dark: '#b7791f' },
      primario:  { name: 'Nivel Primario',   color: '#219ebc', dark: '#0e7490' },
      secundario:{ name: 'Nivel Secundario', color: '#8e44ad', dark: '#6b21a8' },
      superior:  { name: 'Nivel Superior',   color: '#16a34a', dark: '#166534' },
    };

    // ================= HELPERS ==================
    const sanitize = (str) => (str||'').replace(/[<>]/g, s => ({'<':'&lt;','>':'&gt;'}[s]));

    function paragraphsFrom(text){
      const t = (text||'').trim(); if(!t) return '';
      // Separa por bloques de párrafos en blanco y respeta saltos de línea dentro del bloque
      return t.split(/\n\s*\n|\r\n\r\n|\r\r/).map(block => {
        const lines = block.split(/\n|\r\n|\r/).map(l=>sanitize(l));
        return `<p style="margin:0 0 12px; line-height:1.6;">${lines.join('<br/>')}</p>`;
      }).join('');
    }

    function imgRow(url, alt, role){
      // Inserta una fila de imagen (header/footer). role se usa para fallback si falla la carga.
      if(!url) return '';
      const u = /^(https?:)?\//.test(url) ? url : (ASSETS + url);
      const r = role || '';
      return `<tr><td><img data-role="${r}" src="${u}" alt="${alt||''}" width="680" style="display:block;width:100%;max-width:680px;height:auto;border:0;"/></td></tr>`;
    }

    function fallbackHeaderHTML(L){
      return `<tr>
        <td style="padding:20px 24px; background:${L.color}; color:#0b1220; font-family:Arial,Helvetica,sans-serif;">
          <div style="font-size:11px; letter-spacing:.6px; text-transform:uppercase; opacity:.9; font-weight:700;">${sanitize(L.name)}</div>
          <div style="font-size:18px; font-weight:800; line-height:1.2; margin-top:4px;">${sanitize(SCHOOL_NAME)}</div>
        </td>
      </tr>`;
    }

    function fallbackFooterHTML(L){
      return `<tr>
        <td style="padding:12px 24px; background:${L.dark}; color:#ecfeff; font-family:Arial,Helvetica,sans-serif; font-size:12px;">
          <div style="opacity:.95;">${sanitize(SCHOOL_NAME)} – ${sanitize(L.name)}</div>
          <div style="opacity:.7;">${sanitize(BASE_WEBSITE)}</div>
        </td>
      </tr>`;
    }

    function attachImageFallbacks(container, L){
      const imgs = container.querySelectorAll('img[data-role]');
      imgs.forEach(img => {
        img.addEventListener('error', () => {
          const role = img.getAttribute('data-role');
          const td = img.closest('td');
          if(!td) return;
          td.innerHTML = role === 'header' ? fallbackHeaderHTML(L) : fallbackFooterHTML(L);
        }, { once: true });
      });
    }

    function buildEmailHTML({nivel, cuerpo, firmaNombre}){
      const L = LEVELS[nivel] || LEVELS.primario;
      const imgs = IMAGES[nivel] || IMAGES.primario;
      return `
<table role="presentation" width="100%" cellpadding="0" cellspacing="0" style="background:#f4f6f8;padding:24px 0;">
  <tr><td align="center">
    <table role="presentation" width="680" cellpadding="0" cellspacing="0" style="max-width:680px;background:#fff;border:1px solid #e5e7eb;">
      ${imgRow(imgs.header, 'Header ' + L.name, 'header')}
      <tr><td style="padding:20px 24px;font-family:Arial,Helvetica,sans-serif; color:#111827; font-size:14px;">
        ${paragraphsFrom(cuerpo)}
        ${firmaNombre ? `<p style="margin-top:12px;font-weight:700;">${sanitize(firmaNombre)}</p>` : ''}
      </td></tr>
      ${imgRow(imgs.footer, 'Footer ' + L.name, 'footer')}
    </table>
  </td></tr>
</table>`;
    }

    // ================ UI WIRING ================
    const els = {
      nivel: document.getElementById('nivel'),
      asunto: document.getElementById('asunto'),
      cuerpo: document.getElementById('cuerpo'),
      firmaNombre: document.getElementById('firmaNombre'),
      preview: document.getElementById('preview'),
      btnGenerar: document.getElementById('btn-generar'),
      btnCopiarHtml: document.getElementById('btn-copiar-html'),
      btnCopiarAsunto: document.getElementById('btn-copiar-asunto'),
    };

    function gather(){
      return {
        nivel: els.nivel.value,
        asunto: (els.asunto.value||'').trim(),
        cuerpo: els.cuerpo.value,
        firmaNombre: els.firmaNombre.value,
      };
    }

    function update(){
      const data = gather();
      els.preview.innerHTML = buildEmailHTML(data);
      attachImageFallbacks(els.preview, LEVELS[data.nivel] || LEVELS.primario);
      els.btnCopiarHtml.disabled = false;
      els.btnCopiarAsunto.disabled = !data.asunto;
    }

    async function copyRichHTML(html){
      try {
        if (navigator.clipboard && window.ClipboardItem) {
          const item = new ClipboardItem({
            'text/html': new Blob([html], {type:'text/html'}),
            'text/plain': new Blob([html.replace(/<[^>]+>/g,'')], {type:'text/plain'})
          });
          await navigator.clipboard.write([item]);
          return true;
        } else {
          // Fallback contentEditable
          const tmp = document.createElement('div');
          tmp.contentEditable = 'true';
          tmp.style.position = 'fixed'; tmp.style.left = '-9999px';
          document.body.appendChild(tmp);
          tmp.innerHTML = html;
          const range = document.createRange(); range.selectNodeContents(tmp);
          const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);
          const ok = document.execCommand('copy');
          document.body.removeChild(tmp);
          return ok;
        }
      } catch (e) { console.error(e); return false; }
    }

    els.btnGenerar.addEventListener('click', update);
    els.btnCopiarHtml.addEventListener('click', async ()=>{
      const ok = await copyRichHTML(buildEmailHTML(gather()));
      els.btnCopiarHtml.textContent = ok ? '¡Copiado!' : 'No se pudo copiar :(';
      setTimeout(()=> els.btnCopiarHtml.textContent = 'Copiar HTML', 1500);
    });
    els.btnCopiarAsunto.addEventListener('click', async ()=>{
      const a = (els.asunto.value||'').trim(); if(!a) return;
      try{ await navigator.clipboard.writeText(a); els.btnCopiarAsunto.textContent='Asunto copiado'; }catch{ els.btnCopiarAsunto.textContent='No se pudo copiar'; }
      setTimeout(()=> els.btnCopiarAsunto.textContent='Copiar Asunto', 1400);
    });

    ['nivel','asunto','cuerpo','firmaNombre'].forEach(id=> document.getElementById(id).addEventListener('input', update));

    // ================ SELF TESTS ================
    (function selfTests(){
      const tests = [];
      const t1 = imgRow('header_primario.png','h','header');
      tests.push(t1.startsWith('<tr>') && t1.includes('data-role="header"'));
      const t2 = buildEmailHTML({nivel:'primario', cuerpo:'Linea 1\n\nLinea 2', firmaNombre:'Test'});
      tests.push(/Footer/.test(t2) && /Header/.test(t2) && /<p/.test(t2));
      const t3 = paragraphsFrom('a\n\nb');
      tests.push((t3.match(/<p/g)||[]).length === 2);
      const allPass = tests.every(Boolean);
      if(!allPass){ console.error('Self-tests failed', {tests}); }
    })();

    // Estado inicial
    update();
  </script>
</body>
</html>
